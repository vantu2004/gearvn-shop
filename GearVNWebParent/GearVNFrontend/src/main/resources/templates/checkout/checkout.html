<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">

<!-- Head -->
<head th:replace="fragments :: page_head('Checkout', 'none')"></head>
<!-- Head -->

<body class="d-flex flex-column min-vh-100">
	<!-- Header -->
	<header th:replace="fragments :: header"></header>
	<!-- Header -->

	<div class="container mt-5 flex-grow-1">
		<h2>Checkout</h2>

		<div class="container mt-3 row">
			<!-- Left Section -->
			<div class="col-sm-8">
				<!-- Shipping Information -->
				<div class="card">
					<div class="card-header">
						<h5>Shipping Information</h5>
					</div>
					<div class="card-body">
						<p>
							<b>Ship to:</b>&nbsp; [[${fullAddress}]] <a
								th:href="@{/address_book(redirect=checkout)}">[Ship to
								another address]</a>
						</p>
						<p>
							<b>Days to deliver:</b> [[${checkoutInfo.deliverDays}]] day(s)
						</p>
						<p>
							<b>Expected delivery date:</b>
							[[${#dates.format(checkoutInfo.deliverDate, 'E, dd MMM yyyy')}]]
						</p>
					</div>
				</div>

				<!-- Payment Method -->
				<div class="card mt-3 mb-3">
					<div class="card-header">
						<h5>Payment Method</h5>
					</div>
					<div class="card-body">
						<div th:if="${checkoutInfo.codSupported}">
							<form th:action="@{/place_order}" method="post">
								<div class="d-flex justify-content-between align-items-center">
									<div class="form-check">
										<input class="form-check-input" type="radio"
											name="paymentMethod" id="radioCOD" value="COD" /> <label
											class="form-check-label" for="radioCOD"> Cash on
											Delivery (COD) </label>
									</div>
									<button class="btn btn-primary d-none" type="submit" id="buttonSubmit">
										Place Order with COD</button>
								</div>
							</form>
						</div>

						<!-- PayPal -->
						<div id="paypal-button-container"></div>
						<form th:action="@{/process_paypal_order}" method="post"
							id="paypalForm">
							<input type="hidden" name="orderId" id="orderId" /> <input
								type="hidden" name="paymentMethod" value="PAYPAL" />
						</form>
					</div>
				</div>
			</div>

			<!-- Right Section -->
			<div class="col-sm-4">
				<!-- Order Summary -->
				<div class="card">
					<div class="card-header">
						<h5>Order Summary</h5>
					</div>
					<div class="card-body">
						<table class="w-100">
							<th:block th:each="item : ${cartItems}"
								th:with="product=${item.product}">
								<tr>
									<td colspan="2"><a th:href="@{'/p/' + ${product.alias}}"
										target="_blank" class="fw-bold"> [[${product.shortName}]]
									</a></td>
								</tr>
								<tr>
									<td>x[[${item.quantity}]]</td>
									<td class="text-end"><th:block
											th:replace="fragments :: formatPriceForCheckout(${item.getTotalPrice})" />
									</td>
								</tr>
								<tr>
									<td>Ship:</td>
									<td class="text-end"><th:block
											th:replace="fragments :: formatPriceForCheckout(${item.shippingCost})" />
									</td>
								</tr>
								<tr>
									<td colspan="2"><hr /></td>
								</tr>
							</th:block>
						</table>

						<!-- Totals -->
						<div class="row mt-2">
							<div class="col">Product Total:</div>
							<div class="col text-end">
								<th:block
									th:replace="fragments :: formatPriceForCheckout(${checkoutInfo.productTotal})" />
							</div>
						</div>

						<div class="row mt-2">
							<div class="col">Shipping Total:</div>
							<div class="col text-end">
								<th:block
									th:replace="fragments :: formatPriceForCheckout(${checkoutInfo.shippingCostTotal})" />
							</div>
						</div>

						<div class="row mt-2">
							<div class="col">Payment Total:</div>
							<div class="col text-end fw-bold text-danger">
								<th:block
									th:replace="fragments :: formatPriceForCheckout(${checkoutInfo.paymentTotal})" />
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Footer -->
	<footer th:replace="fragments :: footer" class="mt-auto"></footer>
	<!-- Footer -->

	<!-- jQuery Script -->
	<script type="text/javascript">
		// url
		let contextPath = "[[@{/}]]";

		// csrf
		let csrfHeader = "[[${_csrf.headerName}]]";
		let csrfValue = "[[${_csrf.token}]]";
		
		$(document).ready(function () {
			$("#radioCOD").on("click", function () {
				$("#buttonSubmit").removeClass("d-none");
			});
		});
		
	</script>

</body>

</html>